# RotorDynamics

## Basic Dynamic Model

This fundamental equation represents the motor dynamics, using a time constant and a gain to translate PWM duty cycle to rotational speed change:
   
![スクリーンショット 2023-12-04 11 19 59](https://github.com/toppers/hakoniwa-px4sim/assets/164193/b5c3f274-0dd7-4742-981f-7ac61d0f9d74)

Where:
 - **Ω** is the rotor's angular velocity in revolutions per second (RPS).
 - **k** is the conversion factor (gain) from PWM duty cycle to angular velocity.
 - **τ** is the motor's time constant, indicating its responsiveness.


## Saturation Effect

This equation models the saturation effect as the motor’s angular velocity approaches its limit:

![スクリーンショット 2023-11-26 8 41 05](https://github.com/toppers/hakoniwa-px4sim/assets/164193/d3d74b4e-3e3b-4bc2-b467-59404d123b35)

As **Ω** approaches **Ωmax**, the increase in **dΩ/dt** is moderated by substituting **Ω** with **Ωsat(Ω)** in the dynamic model, thereby incorporating the saturation effect without exceeding the motor's maximum speed.


# Thrust and Torque Dynamics

This section details the dynamics of thrust and torque generated by the drone's rotors, which are pivotal for controlling the drone's flight behavior.

## Thrust U

The collective thrust **U** from all rotors is calculated as the sum of the individual thrusts **Ti** produced by each rotor, which is proportional to the square of the rotor's angular velocity (**Ω**).

![スクリーンショット 2023-11-26 13 15 00](https://github.com/toppers/hakoniwa-px4sim/assets/164193/1d371d4a-fcac-4723-b886-4212290fcfc6)

Where:

* **Ti​** is the thrust generated by the i-th rotor.
* **A** is a constant that relates the rotor's angular velocity to the generated thrust.
* **Ωi** is the angular velocity of the i-th rotor.

## Torque (τ)
The total torque (**τ**) is the sum of the torques generated by each rotor, which is a function of the lift-induced torque and the aerodynamic torque (**τai**
) from each rotor, considering the direction of rotation.

![スクリーンショット 2023-11-26 13 18 37](https://github.com/toppers/hakoniwa-px4sim/assets/164193/92d892aa-3b7a-4c5e-80d0-d444e115a85a)

Where:

* **L** is the arm length from the drone's center to each rotor.
* **ri** is the position vector for the i-th rotor relative to the drone's center.
* **ez**​ is the unit vector in the negative direction of the z-axis (downward direction relative to the drone).
* **epi** is a scalar indicating the direction of rotation, with 1 for clockwise and -1 for counterclockwise rotation.
* **B** is the torque constant.
* **Jr** is the rotor's moment of inertia.
* **dΩ/dt** is the rate of change of the rotor's angular velocity.

These equations compute the thrust and torque for each rotor and aggregate them to determine the overall forces and moments acting on the drone. Understanding these dynamics is essential for precise control of the drone's altitude, attitude, and stability during flight maneuvers.
